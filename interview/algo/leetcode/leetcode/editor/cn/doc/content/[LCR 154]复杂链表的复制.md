<p>è¯·å®ç° <code>copyRandomList</code> å‡½æ•°ï¼Œå¤åˆ¶ä¸€ä¸ªå¤æ‚é“¾è¡¨ã€‚åœ¨å¤æ‚é“¾è¡¨ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹é™¤äº†æœ‰ä¸€ä¸ª <code>next</code> æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿˜æœ‰ä¸€ä¸ª <code>random</code> æŒ‡é’ˆæŒ‡å‘é“¾è¡¨ä¸­çš„ä»»æ„èŠ‚ç‚¹æˆ–è€… <code>null</code>ã€‚</p>

<p>&nbsp;</p>

<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>

<p><img alt="" src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/01/09/e1.png" /></p>

<pre><strong>è¾“å…¥ï¼š</strong>head = [[7,null],[13,0],[11,4],[10,2],[1,0]]
<strong>è¾“å‡ºï¼š</strong>[[7,null],[13,0],[11,4],[10,2],[1,0]]
</pre>

<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>

<p><img alt="" src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/01/09/e2.png" /></p>

<pre><strong>è¾“å…¥ï¼š</strong>head = [[1,1],[2,1]]
<strong>è¾“å‡ºï¼š</strong>[[1,1],[2,1]]
</pre>

<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>

<p><strong><img alt="" src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/01/09/e3.png" /></strong></p>

<pre><strong>è¾“å…¥ï¼š</strong>head = [[3,null],[3,0],[3,null]]
<strong>è¾“å‡ºï¼š</strong>[[3,null],[3,0],[3,null]]
</pre>

<p><strong>ç¤ºä¾‹ 4ï¼š</strong></p>

<pre><strong>è¾“å…¥ï¼š</strong>head = []
<strong>è¾“å‡ºï¼š</strong>[]
<strong>è§£é‡Šï¼š</strong>ç»™å®šçš„é“¾è¡¨ä¸ºç©ºï¼ˆç©ºæŒ‡é’ˆï¼‰ï¼Œå› æ­¤è¿”å› nullã€‚
</pre>

<p>&nbsp;</p>

<p><strong>æç¤ºï¼š</strong></p>

<ul> 
 <li><code>-10000 &lt;= Node.val &lt;= 10000</code></li> 
 <li><code>Node.random</code>&nbsp;ä¸ºç©ºï¼ˆnullï¼‰æˆ–æŒ‡å‘é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ã€‚</li> 
 <li>èŠ‚ç‚¹æ•°ç›®ä¸è¶…è¿‡ 1000 ã€‚</li> 
</ul>

<p>&nbsp;</p>

<p><strong>æ³¨æ„ï¼š</strong>æœ¬é¢˜ä¸ä¸»ç«™ 138 é¢˜ç›¸åŒï¼š<a href="https://leetcode-cn.com/problems/copy-list-with-random-pointer/">https://leetcode-cn.com/problems/copy-list-with-random-pointer/</a></p>

<p>&nbsp;</p>

<details><summary><strong>Related Topics</strong></summary>å“ˆå¸Œè¡¨ | é“¾è¡¨</details><br>

<div>ğŸ‘ 798, ğŸ‘ 0<span style='float: right;'><span style='color: gray;'><a href='https://github.com/labuladong/fucking-algorithm/discussions/939' target='_blank' style='color: lightgray;text-decoration: underline;'>bug åé¦ˆ</a> | <a href='https://labuladong.online/algo/fname.html?fname=jbæ’ä»¶ç®€ä»‹' target='_blank' style='color: lightgray;text-decoration: underline;'>ä½¿ç”¨æŒ‡å—</a> | <a href='https://labuladong.online/algo/images/others/%E5%85%A8%E5%AE%B6%E6%A1%B6.jpg' target='_blank' style='color: lightgray;text-decoration: underline;'>æ›´å¤šé…å¥—æ’ä»¶</a></span></span></div>

<div id="labuladong"><hr>

**é€šçŸ¥ï¼šå·²å®Œæˆç½‘ç«™æ•™ç¨‹ã€ç½‘ç«™ä¹ é¢˜ã€é…å¥—æ’ä»¶ä¸­æ‰€æœ‰å¤šè¯­è¨€ä»£ç çš„æ ¡å‡†ï¼Œè§£å†³äº†ä¹‹å‰ chatGPT ç¿»è¯‘å¯èƒ½å‡ºé”™çš„é—®é¢˜~**

<details><summary><strong>labuladong æ€è·¯</strong></summary>

<div id="labuladong_solution_zh">

## åŸºæœ¬æ€è·¯

è¿™é“é¢˜å’Œ [138. å¤åˆ¶å¸¦éšæœºæŒ‡é’ˆçš„é“¾è¡¨](/problems/copy-list-with-random-pointer) ç›¸åŒã€‚

è¿™é“é¢˜ç›®ï¼Œå°±å±äºä¼šè€…ä¸éš¾ï¼Œéš¾è€…ä¸ä¼šçš„é‚£ç±»é¢˜ï¼Œåé¢ä»–è¿˜å¯ä»¥ç»™ä½ å˜å‡ºæ›´å¤šèŠ±æ ·ï¼Œæ¯”å¦‚å…‹éš†å¸¦éšæœºæŒ‡é’ˆçš„äºŒå‰æ ‘ï¼Œä½ ä¼šä¸ä¼šï¼Ÿé‚£å†è®©ä½ å…‹éš†å›¾ï¼Œä½ ä¼šä¸ä¼šï¼Ÿ

**å¯¹äºæ•°æ®ç»“æ„å¤åˆ¶ï¼Œç”­ç®¡ä»–æ€ä¹ˆå˜ï¼Œä½ å°±è®°ä½æœ€ç®€å•çš„æ–¹å¼ï¼šä¸€ä¸ªå“ˆå¸Œè¡¨ + ä¸¤æ¬¡éå†**ã€‚

ç¬¬ä¸€æ¬¡éå†ä¸“é—¨å…‹éš†èŠ‚ç‚¹ï¼Œå€ŸåŠ©å“ˆå¸Œè¡¨æŠŠåŸå§‹èŠ‚ç‚¹å’Œå…‹éš†èŠ‚ç‚¹çš„æ˜ å°„å­˜å‚¨èµ·æ¥ï¼›ç¬¬äºŒæ¬¡ä¸“é—¨ç»„è£…èŠ‚ç‚¹ï¼Œç…§ç€åŸæ•°æ®ç»“æ„çš„æ ·å­ï¼ŒæŠŠå…‹éš†èŠ‚ç‚¹çš„æŒ‡é’ˆç»„è£…èµ·æ¥ã€‚

é¢˜ç›®å¦‚æœè®©ä½ å…‹éš†å¸¦éšæœºæŒ‡é’ˆçš„äºŒå‰æ ‘ï¼Œæˆ–è€…å…‹éš†å›¾ï¼Œéƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡æ˜¯éå†çš„æ–¹å¼ä» for å¾ªç¯è¿­ä»£éå†å˜æˆ `traverse` é€’å½’å‡½æ•°éå†ç½¢äº†ã€‚

</div>

**æ ‡ç­¾ï¼šå“ˆå¸Œè¡¨ï¼Œ[é“¾è¡¨](https://labuladong.online/algo/)**

<div id="solution">

## è§£æ³•ä»£ç 



<div class="tab-panel"><div class="tab-nav">
<button data-tab-item="cpp" class="tab-nav-button btn " data-tab-group="default" onclick="switchTab(this)">cppğŸ¤–</button>

<button data-tab-item="python" class="tab-nav-button btn " data-tab-group="default" onclick="switchTab(this)">pythonğŸ¤–</button>

<button data-tab-item="java" class="tab-nav-button btn active" data-tab-group="default" onclick="switchTab(this)">javağŸŸ¢</button>

<button data-tab-item="go" class="tab-nav-button btn " data-tab-group="default" onclick="switchTab(this)">goğŸ¤–</button>

<button data-tab-item="javascript" class="tab-nav-button btn " data-tab-group="default" onclick="switchTab(this)">javascriptğŸ¤–</button>
</div><div class="tab-content">
<div data-tab-item="cpp" class="tab-item " data-tab-group="default"><div class="highlight">

```cpp
// æ³¨æ„ï¼šcpp ä»£ç ç”± chatGPTğŸ¤– æ ¹æ®æˆ‘çš„ java ä»£ç ç¿»è¯‘ï¼Œæ—¨åœ¨å¸®åŠ©ä¸åŒèƒŒæ™¯çš„è¯»è€…ç†è§£ç®—æ³•é€»è¾‘ã€‚
// æœ¬ä»£ç å·²ç»é€šè¿‡åŠ›æ‰£çš„æµ‹è¯•ç”¨ä¾‹ï¼Œåº”è¯¥å¯ç›´æ¥æˆåŠŸæäº¤ã€‚

class Solution {
public:
    Node* copyRandomList(Node* head) {
        unordered_map<Node*, Node*> originToClone;
        // ç¬¬ä¸€æ¬¡éå†ï¼Œå…ˆæŠŠæ‰€æœ‰èŠ‚ç‚¹å…‹éš†å‡ºæ¥
        for (Node* p = head; p != nullptr; p = p->next) {
            if (originToClone.find(p) == originToClone.end()) {
                originToClone[p] = new Node(p->val);
            }
        }
        // ç¬¬äºŒæ¬¡éå†ï¼ŒæŠŠå…‹éš†èŠ‚ç‚¹çš„ç»“æ„è¿æ¥å¥½
        for (Node* p = head; p != nullptr; p = p->next) {
            if (p->next != nullptr) {
                originToClone[p]->next = originToClone[p->next];
            }
            if (p->random != nullptr) {
                originToClone[p]->random = originToClone[p->random];
            }
        }
        // è¿”å›å…‹éš†ä¹‹åçš„å¤´ç»“ç‚¹
        return originToClone[head];
    }
};

// ç”¨é€’å½’çš„æ–¹å¼è¿›è¡Œéå†
class Solution2 {
public:
    Node* copyRandomList(Node* head) {
        traverse(head);
        return originToClone[head];
    }

private:
    // è®°å½• DFS éå†è¿‡çš„èŠ‚ç‚¹ï¼Œé˜²æ­¢èµ°å›å¤´è·¯
    unordered_set<Node*> visited;
    // è®°å½•åŸèŠ‚ç‚¹åˆ°å…‹éš†èŠ‚ç‚¹çš„æ˜ å°„
    unordered_map<Node*, Node*> originToClone;

    // DFS å›¾éå†æ¡†æ¶
    void traverse(Node* node) {
        if (node == nullptr) {
            return;
        }
        if (visited.find(node) != visited.end()) {
            return;
        }
        // å‰åºä½ç½®ï¼Œæ ‡è®°ä¸ºå·²è®¿é—®
        visited.insert(node);
        // å‰åºä½ç½®ï¼Œå…‹éš†èŠ‚ç‚¹
        if (originToClone.find(node) == originToClone.end()) {
            originToClone[node] = new Node(node->val);
        }
        Node* cloneNode = originToClone[node];

        // é€’å½’éå†é‚»å±…èŠ‚ç‚¹ï¼Œå¹¶æ„å»ºå…‹éš†å›¾
        // é€’å½’ä¹‹åï¼Œé‚»å±…èŠ‚ç‚¹ä¸€å®šå­˜åœ¨ originToClone ä¸­

        traverse(node->next);
        cloneNode->next = originToClone[node->next];

        traverse(node->random);
        cloneNode->random = originToClone[node->random];
    }
};
```

</div></div>

<div data-tab-item="python" class="tab-item " data-tab-group="default"><div class="highlight">

```python
# æ³¨æ„ï¼špython ä»£ç ç”± chatGPTğŸ¤– æ ¹æ®æˆ‘çš„ java ä»£ç ç¿»è¯‘ï¼Œæ—¨åœ¨å¸®åŠ©ä¸åŒèƒŒæ™¯çš„è¯»è€…ç†è§£ç®—æ³•é€»è¾‘ã€‚
# æœ¬ä»£ç å·²ç»é€šè¿‡åŠ›æ‰£çš„æµ‹è¯•ç”¨ä¾‹ï¼Œåº”è¯¥å¯ç›´æ¥æˆåŠŸæäº¤ã€‚

class Solution:
    def copyRandomList(self, head: 'Node') -> 'Node':
        origin_to_clone = {}
        # ç¬¬ä¸€æ¬¡éå†ï¼Œå…ˆæŠŠæ‰€æœ‰èŠ‚ç‚¹å…‹éš†å‡ºæ¥
        p = head
        while p:
            if p not in origin_to_clone:
                origin_to_clone[p] = Node(p.val)
            p = p.next
        
        # ç¬¬äºŒæ¬¡éå†ï¼ŒæŠŠå…‹éš†èŠ‚ç‚¹çš„ç»“æ„è¿æ¥å¥½
        p = head
        while p:
            if p.next:
                origin_to_clone[p].next = origin_to_clone[p.next]
            if p.random:
                origin_to_clone[p].random = origin_to_clone[p.random]
            p = p.next
        
        # è¿”å›å…‹éš†ä¹‹åçš„å¤´ç»“ç‚¹
        return origin_to_clone.get(head)

# ç”¨é€’å½’çš„æ–¹å¼è¿›è¡Œéå†
class Solution2:
    def copyRandomList(self, head: 'Node') -> 'Node':
        self.traverse(head)
        return self.origin_to_clone.get(head)

    # è®°å½• DFS éå†è¿‡çš„èŠ‚ç‚¹ï¼Œé˜²æ­¢èµ°å›å¤´è·¯
    visited = set()
    # è®°å½•åŸèŠ‚ç‚¹åˆ°å…‹éš†èŠ‚ç‚¹çš„æ˜ å°„
    origin_to_clone = {}

    # DFS å›¾éå†æ¡†æ¶
    def traverse(self, node: 'Node') -> None:
        if not node or node in self.visited:
            return
        # å‰åºä½ç½®ï¼Œæ ‡è®°ä¸ºå·²è®¿é—®
        self.visited.add(node)
        # å‰åºä½ç½®ï¼Œå…‹éš†èŠ‚ç‚¹
        if node not in self.origin_to_clone:
            self.origin_to_clone[node] = Node(node.val)
        clone_node = self.origin_to_clone[node]

        # é€’å½’éå†é‚»å±…èŠ‚ç‚¹ï¼Œå¹¶æ„å»ºå…‹éš†å›¾
        self.traverse(node.next)
        clone_node.next = self.origin_to_clone.get(node.next)
        self.traverse(node.random)
        clone_node.random = self.origin_to_clone.get(node.random)
        # é€’å½’ä¹‹åï¼Œé‚»å±…èŠ‚ç‚¹ä¸€å®šå­˜åœ¨ originToClone ä¸­
```

</div></div>

<div data-tab-item="java" class="tab-item active" data-tab-group="default"><div class="highlight">

```java
class Solution {
    public Node copyRandomList(Node head) {
        HashMap<Node, Node> originToClone = new HashMap<>();
        // ç¬¬ä¸€æ¬¡éå†ï¼Œå…ˆæŠŠæ‰€æœ‰èŠ‚ç‚¹å…‹éš†å‡ºæ¥
        for (Node p = head; p != null; p = p.next) {
            if (!originToClone.containsKey(p)) {
                originToClone.put(p, new Node(p.val));
            }
        }
        // ç¬¬äºŒæ¬¡éå†ï¼ŒæŠŠå…‹éš†èŠ‚ç‚¹çš„ç»“æ„è¿æ¥å¥½
        for (Node p = head; p != null; p = p.next) {
            if (p.next != null) {
                originToClone.get(p).next = originToClone.get(p.next);
            }
            if (p.random != null) {
                originToClone.get(p).random = originToClone.get(p.random);
            }
        }
        // è¿”å›å…‹éš†ä¹‹åçš„å¤´ç»“ç‚¹
        return originToClone.get(head);
    }
}

// ç”¨é€’å½’çš„æ–¹å¼è¿›è¡Œéå†
class Solution2 {
    public Node copyRandomList(Node head) {
        traverse(head);
        return originToClone.get(head);
    }

    // è®°å½• DFS éå†è¿‡çš„èŠ‚ç‚¹ï¼Œé˜²æ­¢èµ°å›å¤´è·¯
    HashSet<Node> visited = new HashSet<>();
    // è®°å½•åŸèŠ‚ç‚¹åˆ°å…‹éš†èŠ‚ç‚¹çš„æ˜ å°„
    HashMap<Node, Node> originToClone = new HashMap<>();

    // DFS å›¾éå†æ¡†æ¶
    void traverse(Node node) {
        if (node == null) {
            return;
        }
        if (visited.contains(node)) {
            return;
        }
        // å‰åºä½ç½®ï¼Œæ ‡è®°ä¸ºå·²è®¿é—®
        visited.add(node);
        // å‰åºä½ç½®ï¼Œå…‹éš†èŠ‚ç‚¹
        if (!originToClone.containsKey(node)) {
            originToClone.put(node, new Node(node.val));
        }
        Node cloneNode = originToClone.get(node);

        // é€’å½’éå†é‚»å±…èŠ‚ç‚¹ï¼Œå¹¶æ„å»ºå…‹éš†å›¾
        // é€’å½’ä¹‹åï¼Œé‚»å±…èŠ‚ç‚¹ä¸€å®šå­˜åœ¨ originToClone ä¸­

        traverse(node.next);
        cloneNode.next = originToClone.get(node.next);

        traverse(node.random);
        cloneNode.random = originToClone.get(node.random);
    }
}
```

</div></div>

<div data-tab-item="go" class="tab-item " data-tab-group="default"><div class="highlight">

```go
// æ³¨æ„ï¼šgo ä»£ç ç”± chatGPTğŸ¤– æ ¹æ®æˆ‘çš„ java ä»£ç ç¿»è¯‘ï¼Œæ—¨åœ¨å¸®åŠ©ä¸åŒèƒŒæ™¯çš„è¯»è€…ç†è§£ç®—æ³•é€»è¾‘ã€‚
// æœ¬ä»£ç å·²ç»é€šè¿‡åŠ›æ‰£çš„æµ‹è¯•ç”¨ä¾‹ï¼Œåº”è¯¥å¯ç›´æ¥æˆåŠŸæäº¤ã€‚

/**
 * Definition for a Node.
 * type Node struct {
 *     Val int
 *     Next *Node
 *	   Random *Node
 * }
 */

func copyRandomList(head *Node) *Node {
    originToClone := make(map[*Node]*Node)
    // ç¬¬ä¸€æ¬¡éå†ï¼Œå…ˆæŠŠæ‰€æœ‰èŠ‚ç‚¹å…‹éš†å‡ºæ¥
    for p := head; p != nil; p = p.Next {
        if _, ok := originToClone[p]; !ok {
            originToClone[p] = &Node{Val:p.Val}
        }
    }
    // ç¬¬äºŒæ¬¡éå†ï¼ŒæŠŠå…‹éš†èŠ‚ç‚¹çš„ç»“æ„è¿æ¥å¥½
    for p := head; p != nil; p = p.Next {
        if p.Next != nil {
            originToClone[p].Next = originToClone[p.Next]
        }
        if p.Random != nil {
            originToClone[p].Random = originToClone[p.Random]
        }
    }
    // è¿”å›å…‹éš†ä¹‹åçš„å¤´ç»“ç‚¹
    return originToClone[head]
}

// ç”¨é€’å½’çš„æ–¹å¼è¿›è¡Œéå†
func copyRandomList2(head *Node) *Node {
    if head == nil {
        return nil
    }
    visited := make(map[*Node]bool)
    originToClone := make(map[*Node]*Node)
    traverse(head, visited, originToClone)
    return originToClone[head]
}

// DFS å›¾éå†æ¡†æ¶
func traverse(node *Node, visited map[*Node]bool, originToClone map[*Node]*Node) {
    if visited[node] {
        return
    }
    // å‰åºä½ç½®ï¼Œæ ‡è®°ä¸ºå·²è®¿é—®
    visited[node] = true
    // å‰åºä½ç½®ï¼Œå…‹éš†èŠ‚ç‚¹
    if _, ok := originToClone[node]; !ok {
        originToClone[node] = &Node{Val:node.Val}
    }
    cloneNode := originToClone[node]

    // é€’å½’éå†é‚»å±…èŠ‚ç‚¹ï¼Œå¹¶æ„å»ºå…‹éš†å›¾
    // é€’å½’ä¹‹åï¼Œé‚»å±…èŠ‚ç‚¹ä¸€å®šå­˜åœ¨ originToClone ä¸­
    if node.Next != nil {
        traverse(node.Next, visited, originToClone)
        cloneNode.Next = originToClone[node.Next]
    }
    if node.Random != nil {
        traverse(node.Random, visited, originToClone)
        cloneNode.Random = originToClone[node.Random]
    }
}
```

</div></div>

<div data-tab-item="javascript" class="tab-item " data-tab-group="default"><div class="highlight">

```javascript
// æ³¨æ„ï¼šjavascript ä»£ç ç”± chatGPTğŸ¤– æ ¹æ®æˆ‘çš„ java ä»£ç ç¿»è¯‘ï¼Œæ—¨åœ¨å¸®åŠ©ä¸åŒèƒŒæ™¯çš„è¯»è€…ç†è§£ç®—æ³•é€»è¾‘ã€‚
// æœ¬ä»£ç å·²ç»é€šè¿‡åŠ›æ‰£çš„æµ‹è¯•ç”¨ä¾‹ï¼Œåº”è¯¥å¯ç›´æ¥æˆåŠŸæäº¤ã€‚

var copyRandomList = function(head) {
    const originToClone = new Map();

    // ç¬¬ä¸€æ¬¡éå†ï¼Œå…ˆæŠŠæ‰€æœ‰èŠ‚ç‚¹å…‹éš†å‡ºæ¥
    for (let p = head; p != null; p = p.next) {
        if (!originToClone.has(p)) {
            originToClone.set(p, new Node(p.val));
        }
    }

    // ç¬¬äºŒæ¬¡éå†ï¼ŒæŠŠå…‹éš†èŠ‚ç‚¹çš„ç»“æ„è¿æ¥å¥½
    for (let p = head; p != null; p = p.next) {
        if (p.next != null) {
            originToClone.get(p).next = originToClone.get(p.next);
        }
        if (p.random != null) {
            originToClone.get(p).random = originToClone.get(p.random);
        }
    }

    // è¿”å›å…‹éš†ä¹‹åçš„å¤´ç»“ç‚¹
    return originToClone.get(head);
};

// ç”¨é€’å½’çš„æ–¹å¼è¿›è¡Œéå†
var copyRandomList2 = function(head) {
    const visited = new Set();
    const originToClone = new Map();

    // DFS å›¾éå†æ¡†æ¶
    const traverse = (node) => {
        if (node == null) {
            return;
        }
        if (visited.has(node)) {
            return;
        }

        // å‰åºä½ç½®ï¼Œæ ‡è®°ä¸ºå·²è®¿é—®
        visited.add(node);

        // å‰åºä½ç½®ï¼Œå…‹éš†èŠ‚ç‚¹
        if (!originToClone.has(node)) {
            originToClone.set(node, new Node(node.val));
        }

        const cloneNode = originToClone.get(node);

        // é€’å½’éå†é‚»å±…èŠ‚ç‚¹ï¼Œå¹¶æ„å»ºå…‹éš†å›¾
        // é€’å½’ä¹‹åï¼Œé‚»å±…èŠ‚ç‚¹ä¸€å®šå­˜åœ¨ originToClone ä¸­

        traverse(node.next);
        cloneNode.next = originToClone.get(node.next);

        traverse(node.random);
        cloneNode.random = originToClone.get(node.random);
    };

    traverse(head);
    return originToClone.get(head);
};
```

</div></div>
</div></div>

**ç±»ä¼¼é¢˜ç›®**ï¼š
  - [å‰‘æŒ‡ Offer 35. å¤æ‚é“¾è¡¨çš„å¤åˆ¶ ğŸŸ ](/problems/fu-za-lian-biao-de-fu-zhi-lcof)

</div>

</details>
</div>

